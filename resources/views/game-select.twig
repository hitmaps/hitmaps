{% extends 'base.twig' %}

{% set page_title = 'Home' %}
{% set body_style = "background: url('#{settings.cdnLocation}/#{model.jpgBackgroundFileExtension}/backgrounds/loading.#{model.jpgBackgroundFileExtension}') no-repeat center; background-size: cover" %}

{% block content %}
    <header class="row">
        <div class="col text-center">
            <h1>Interactive Maps For</h1>
            <img src="{{ settings.cdnLocation }}/{{ model.pngBackgroundFileExtension }}/logos/hitman2.{{ model.pngBackgroundFileExtension }}">
        </div>
    </header>
    <div class="row dashboard">
        {% for game in model.games %}
            <div class="game col-lg" style="background: url('{{ settings.cdnLocation }}/{{ model.jpgBackgroundFileExtension }}/backgrounds/{{ game.slug }}.{{ model.jpgBackgroundFileExtension }}') no-repeat center; background-size: cover">
                <a href="/games/{{ game.slug }}">
                    <p>&nbsp;</p>
                    <div class="game-info">
                        <div class="image">
                            <img src="/img/game-icons/campaign.png" class="normal img-fluid" alt="Campaign Icon">
                            <img src="/img/game-icons/campaign-inverted.png" class="inverted img-fluid" alt="Campaign Icon">
                        </div>
                        <div class="text">
                            <h2>Campaign</h2>
                            <h1>{{ game.fullName }}</h1>
                        </div>
                    </div>
                </a>
            </div>
        {% endfor %}
        {% if model.elusiveTarget != null %}
        <div class="elusive-target col-lg" style="background: url('{{ settings.cdnLocation }}/{{ model.jpgBackgroundFileExtension }}{{ model.elusiveTarget.imageUrl }}.{{ model.jpgBackgroundFileExtension }}') no-repeat center; background-size: cover">
            <a href="#">
                <p>&nbsp;</p>
                <p class="countdown">
                    <img src="/img/game-icons/elusive-target.png" style="height: 48px; width: 48px">
                    <span id="elusive-countdown"></span>
                </p>
                <div class="elusive-target-info">
                    <div class="image">
                        <img src="/img/game-icons/elusive-target.png" class="normal img-fluid" alt="Elusive Target Icon">
                        <img src="/img/game-icons/elusive-target-inverted.png" class="inverted img-fluid" alt="Elusive Target Icon">
                    </div>
                    <div class="text">
                        <h2>Elusive Target</h2>
                        <h1>{{ model.elusiveTarget.name }}</h1>
                    </div>
                </div>
            </a>
        </div>
        <script>
            var expirationUtc = moment.utc('{{ model.elusiveTarget.endingTime|date('Y-m-d H:i:s') }}');

            var countdown = setInterval(function() {
                var currentUtc = moment.utc();
                var difference = moment(expirationUtc.diff(currentUtc));

                if (difference < 0) {
                    $('#elusive-countdown').text('Ended');
                    clearInterval(countdown);
                    return;
                }

                var days = expirationUtc.diff(currentUtc, 'days');
                var hours = difference.hours();
                var minutes = getFormattedDuration(difference.minutes());
                var seconds = getFormattedDuration(difference.seconds());
                if (days > 0) {
                    hours += days * 24;
                }
                hours = getFormattedDuration(hours);

                $('#elusive-countdown').text(hours + ':' + minutes + ':' + seconds);
            }, 1000);

            function getFormattedDuration(duration) {
                if (duration < 10) {
                    return '0' + duration;
                }

                return duration;
            }
        </script>
        {% endif %}
    </div>
{% endblock %}